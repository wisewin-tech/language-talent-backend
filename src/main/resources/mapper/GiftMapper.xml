<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 【用户】 -->
<mapper namespace="com.wisewin.backend.dao.GiftDAO">
    <!--通过条件分页查询键值信息-->
    <select id="selectAll" resultType="com.wisewin.backend.entity.bo.GiftBO"
            parameterType="java.util.Map">
        select
        `id`,`title`,`value`,`cardnumber`,`scope`,
        `exchangeyard`,  `starttime`,`finishtime`,
        `cause`,`create_time`,`status`
        from
        lt_gift
        <where>

            <if test="giftParam.title!=null and  giftParam.title!='' "> AND `title` LIKE  '%${giftParam.title}%' </if>
            <if test="giftParam.scope!=null and  giftParam.scope!='' "> AND `scope` LIKE '%${giftParam.scope}%'</if>
            <if test="giftParam.cardnumber!=null and  giftParam.cardnumber!='' "> AND `cardnumber` LIKE '%${giftParam.cardnumber}%'</if>
            <if test="giftParam.value!=null and  giftParam.value!='' "> AND `value`=#{giftParam.value}</if>
            <if test="giftParam.status!=null and  giftParam.status!='' ">AND `status`=#{giftParam.status}</if>
        </where>
        order by create_time desc
        <include refid="limit" />

    </select>
    <sql id="limit">
      limit #{pageOffset},#{pageSize}
    </sql>

    <!--添加礼品卡-->
    <insert id="addGift" >

        INSERT  INTO lt_gift
        ( `title`,`value`,`cardnumber`,`scope`,`exchangeyard`,  `starttime`,`finishtime`,
         `cause`,`create_time`)
        VALUES
        <foreach collection ="list" item="giftParam" separator =",">
            (
            #{giftParam.title}, #{giftParam.value},
            #{giftParam.cardnumber}, #{giftParam.scope}, #{giftParam.exchangeyard},
            #{giftParam.starttime}, #{giftParam.finishtime}, #{giftParam.cause},now()
            )
        </foreach >

    </insert>
    <!--修改礼品卡信息-->
    <update id="updateGift"  useGeneratedKeys="true" keyProperty="id"
            parameterType="com.wisewin.backend.entity.param.GiftParam">

        UPDATE  lt_gift
        <set>
            <if test="title!=null">`title`=#{title},</if>
            <if test="value!=null">`value`=#{value},</if>
            <if test="cardnumber!=null">`cardnumber`=#{cardnumber},</if>
            <if test="scope!=null">`scope`=#{scope},</if>
            <if test="exchangeyard!=null">`exchangeyard`=#{exchangeyard},</if>
            <if test="starttime!=null">`starttime`=#{starttime},</if>
            <if test="finishtime!=null">`finishtime`=#{finishtime},</if>
            update_time=now()
        </set>
        WHERE
        id=#{id}

    </update>

    <!--批量删除礼品卡-->
    <update id="deleteGift">
        DELETE FROM lt_gift
        where id in
        <foreach collection="idArr" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>

    </update>






</mapper>