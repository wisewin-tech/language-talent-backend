<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 【用户】 -->
<mapper namespace="com.wisewin.backend.dao.CertificateDAO">


    <select id="selectUser" parameterType="java.util.Map"
            resultType="com.wisewin.backend.entity.bo.CertificateResultBO">
        SELECT
        ltc.id,ltc.user_id,ltu.nickname,ltc.course_id,ltc.`status`,ltc.`send`,
      course.course_name,course.certificate_image_url
    FROM
        lt_certificate AS ltc
    LEFT JOIN lt_user AS ltu ON ltc.user_id=ltu.id
    LEFT JOIN lt_course AS `course` ON ltc.course_id=course.id
        <where>
            <if test="send!=null">ltc.`send`=#{send},</if>
            <if test="status!=null">ltc.`status`=#{status},</if>
            <if test="userId!=null">ltc.`user_id`=#{userId},</if>
            <if test="mobile!=null">ltu.`mobile`=#{mobile},</if>
        </where>
        <include refid="limit" />
    </select>
    <sql id="limit">
        limit #{pageOffset},#{pageSize}
    </sql>

    <update id="updateSend" parameterType="java.util.Map">
        UPDATE lt_certificate
        <set>
            <if test="send!=null">send=#{send}</if>
        </set>
        where
--         userId=#{userId} and course_id=#{courseId}
        id=#{id}
    </update>

    <!--查询课程数量-->
    <select id="queryUserCount"  parameterType="java.lang.Integer"  resultType="int">
        SELECT  count(id)  FROM   lt_certificate  WHERE  course_id=#{ceId}
    </select>

    <!--添加证书-->
    <insert id="addCertificate"  parameterType="com.wisewin.backend.entity.bo.CertificateResultBO"  >
      INSERT INTO `lt_certificate` ( `user_id`, `course_id`, `send`, `status`, `create_user_id`, `create_time`,
       `update_user_id`, `update_time`)
        VALUES (#{userId},#{courseId},#{status},#{send},#{createUserId},#{createTime},#{updateUserId},#{updateTime});

    </insert>

</mapper>